/**
 * skylark-asttypes - A version of asttypes that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./types","./path","./scope"],function(l,h,f){"use strict";return function(e){function n(e,t,r){if(!(this instanceof n))throw new Error("NodePath constructor cannot be invoked without 'new'");s.call(this,e,t,r)}var t=e.use(l),a=t.namedTypes,o=t.builders,i=t.builtInTypes.number,r=t.builtInTypes.array,s=e.use(h),c=e.use(f),e=n.prototype=Object.create(s.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});Object.defineProperties(e,{node:{get:function(){return Object.defineProperty(this,"node",{configurable:!0,value:this._computeNode()}),this.node}},parent:{get:function(){return Object.defineProperty(this,"parent",{configurable:!0,value:this._computeParent()}),this.parent}},scope:{get:function(){return Object.defineProperty(this,"scope",{configurable:!0,value:this._computeScope()}),this.scope}}}),e.replace=function(){return delete this.node,delete this.parent,delete this.scope,s.prototype.replace.apply(this,arguments)},e.prune=function(){var e=this.parent;this.replace();if(a.VariableDeclaration.check(e.node)){var t=e.get("declarations").value;if(!t||0===t.length)return e.prune()}else if(a.ExpressionStatement.check(e.node)){if(!e.get("expression").value)return e.prune()}else if(a.IfStatement.check(e.node)){t=e;var r=t.get("test").value,n=t.get("alternate").value,s=t.get("consequent").value;s||n?!s&&n&&(s=o.unaryExpression("!",r,!0),a.UnaryExpression.check(r)&&"!"===r.operator&&(s=r.argument),t.get("test").replace(s),t.get("consequent").replace(n),t.get("alternate").replace()):(s=o.expressionStatement(r),t.replace(s))}return e},e._computeNode=function(){var e=this.value;return a.Node.check(e)?e:(e=this.parentPath)&&e.node||null},e._computeParent=function(){var e=this.value,t=this.parentPath;if(!a.Node.check(e)){for(;t&&!a.Node.check(t.value);)t=t.parentPath;t=t&&t.parentPath}for(;t&&!a.Node.check(t.value);)t=t.parentPath;return t||null},e._computeScope=function(){var e=this.value,t=this.parentPath,t=t&&t.scope;return(t=a.Node.check(e)&&c.isEstablishedBy(e)?new c(this,t):t)||null},e.getValueProperty=function(e){return t.getFieldValue(this.value,e)},e.needsParens=function(e){var t=this.parentPath;if(!t)return!1;var r=this.value;if(!a.Expression.check(r))return!1;if("Identifier"===r.type)return!1;for(;!a.Node.check(t.value);)if(!(t=t.parentPath))return!1;var n=t.value;switch(r.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return"MemberExpression"===n.type&&"object"===this.name&&n.object===r;case"BinaryExpression":case"LogicalExpression":switch(n.type){case"CallExpression":return"callee"===this.name&&n.callee===r;case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return!0;case"MemberExpression":return"object"===this.name&&n.object===r;case"BinaryExpression":case"LogicalExpression":{const a=r;var s=n.operator;const t=u[s];s=a.operator,s=u[s];if(t>s)return!0;if(t===s&&"right"===this.name){if(n.right!==a)throw new Error("Nodes must be equal");return!0}}default:return!1}case"SequenceExpression":switch(n.type){case"ForStatement":return!1;case"ExpressionStatement":return"expression"!==this.name;default:return!0}case"YieldExpression":switch(n.type){case"BinaryExpression":case"LogicalExpression":case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"CallExpression":case"MemberExpression":case"NewExpression":case"ConditionalExpression":case"YieldExpression":return!0;default:return!1}case"Literal":return"MemberExpression"===n.type&&i.check(r.value)&&"object"===this.name&&n.object===r;case"AssignmentExpression":case"ConditionalExpression":switch(n.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"BinaryExpression":case"LogicalExpression":return!0;case"CallExpression":return"callee"===this.name&&n.callee===r;case"ConditionalExpression":return"test"===this.name&&n.test===r;case"MemberExpression":return"object"===this.name&&n.object===r;default:return!1}default:if("NewExpression"===n.type&&"callee"===this.name&&n.callee===r)return p(r)}return!(!0===e||this.canBeFirstInStatement()||!this.firstInStatement())};var u={};function p(e){return!!a.CallExpression.check(e)||(r.check(e)?e.some(p):!!a.Node.check(e)&&t.someField(e,function(e,t){return p(t)}))}return[["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"]].forEach(function(e,t){e.forEach(function(e){u[e]=t})}),e.canBeFirstInStatement=function(){var e=this.node;return!a.FunctionExpression.check(e)&&!a.ObjectExpression.check(e)},e.firstInStatement=function(){for(var e,t,r=this;r.parent;r=r.parent){if(e=r.node,t=r.parent.node,a.BlockStatement.check(t)&&"body"===r.parent.name&&0===r.name){if(t.body[0]!==e)throw new Error("Nodes must be equal");return!0}if(a.ExpressionStatement.check(t)&&"expression"===r.name){if(t.expression!==e)throw new Error("Nodes must be equal");return!0}if(a.SequenceExpression.check(t)&&"expressions"===r.parent.name&&0===r.name){if(t.expressions[0]!==e)throw new Error("Nodes must be equal")}else if(a.CallExpression.check(t)&&"callee"===r.name){if(t.callee!==e)throw new Error("Nodes must be equal")}else if(a.MemberExpression.check(t)&&"object"===r.name){if(t.object!==e)throw new Error("Nodes must be equal")}else if(a.ConditionalExpression.check(t)&&"test"===r.name){if(t.test!==e)throw new Error("Nodes must be equal")}else if(function(e){return a.BinaryExpression.check(e)||a.LogicalExpression.check(e)}(t)&&"left"===r.name){if(t.left!==e)throw new Error("Nodes must be equal")}else{if(!a.UnaryExpression.check(t)||t.prefix||"argument"!==r.name)return!1;if(t.argument!==e)throw new Error("Nodes must be equal")}}return!0},n}});
//# sourceMappingURL=sourcemaps/node-path.js.map
