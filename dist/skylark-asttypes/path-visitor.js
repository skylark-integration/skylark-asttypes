/**
 * skylark-asttypes - A version of asttypes that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./types","./node-path"],function(t,e){"use strict";var r=Object.prototype.hasOwnProperty;return function(i){var n=i.use(t),o=i.use(e),s=n.builtInTypes.array,a=n.builtInTypes.object,h=n.builtInTypes.function;const c=function t(){if(!(this instanceof t))throw new Error("PathVisitor constructor cannot be invoked without 'new'");this._reusableContextStack=[],this._methodNameTable=function(t){var e=Object.create(null);for(var r in t)/^visit[A-Z]/.test(r)&&(e[r.slice("visit".length)]=!0);for(var i=n.computeSupertypeLookupTable(e),o=Object.create(null),s=Object.keys(i),a=s.length,c=0;c<a;++c){var u=s[c];r="visit"+i[u],h.check(t[r])&&(o[u]=r)}return o}(this),this._shouldVisitComments=r.call(this._methodNameTable,"Block")||r.call(this._methodNameTable,"Line"),this.Context=v(this),this._visiting=!1,this._changeReported=!1};function u(t,e){for(var i in e)r.call(e,i)&&(t[i]=e[i]);return t}c.fromMethodsObject=function(t){if(t instanceof c)return t;if(!a.check(t))return new c;const e=function t(){if(!(this instanceof t))throw new Error("Visitor constructor cannot be invoked without 'new'");c.call(this)};var r=e.prototype=Object.create(f);return r.constructor=e,u(r,t),u(e,c),h.assert(e.fromMethodsObject),h.assert(e.visit),new e},c.visit=function(t,e){return c.fromMethodsObject(e).visit(t)};var f=c.prototype;function l(t,e){if(!(t instanceof o))throw new Error("");if(!(e instanceof c))throw new Error("");var i=t.value;if(s.check(i))t.each(e.visitWithoutReset,e);else if(a.check(i)){var h=n.getFieldNames(i);e._shouldVisitComments&&i.comments&&h.indexOf("comments")<0&&h.push("comments");for(var u=h.length,f=[],l=0;l<u;++l){var v=h[l];r.call(i,v)||(i[v]=n.getFieldValue(i,v)),f.push(t.get(v))}for(l=0;l<u;++l)e.visitWithoutReset(f[l])}else;return t.value}function v(t){function e(r){if(!(this instanceof e))throw new Error("");if(!(this instanceof c))throw new Error("");if(!(r instanceof o))throw new Error("");Object.defineProperty(this,"visitor",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.currentPath=r,this.needToCallTraverse=!0,Object.seal(this)}if(!(t instanceof c))throw new Error("");var r=e.prototype=Object.create(t);return r.constructor=e,u(r,w),e}f.visit=function(){if(this._visiting)throw new Error("Recursively calling visitor.visit(path) resets visitor state. Try this.visit(path) or this.traverse(path) instead.");this._visiting=!0,this._changeReported=!1,this._abortRequested=!1;for(var t,e=arguments.length,r=new Array(e),i=0;i<e;++i)r[i]=arguments[i];r[0]instanceof o||(r[0]=new o({root:r[0]}).get("root")),this.reset.apply(this,r);try{var n=this.visitWithoutReset(r[0]);t=!0}finally{if(this._visiting=!1,!t&&this._abortRequested)return r[0].value}return n},f.AbortRequest=function(){},f.abort=function(){var t=this;t._abortRequested=!0;var e=new t.AbortRequest;throw e.cancel=function(){t._abortRequested=!1},e},f.reset=function(t){},f.visitWithoutReset=function(t){if(this instanceof this.Context)return this.visitor.visitWithoutReset(t);if(!(t instanceof o))throw new Error("");var e=t.value,r=e&&"object"==typeof e&&"string"==typeof e.type&&this._methodNameTable[e.type];if(!r)return l(t,this);var i=this.acquireContext(t);try{return i.invokeVisitorMethod(r)}finally{this.releaseContext(i)}},f.acquireContext=function(t){return 0===this._reusableContextStack.length?new this.Context(t):this._reusableContextStack.pop().reset(t)},f.releaseContext=function(t){if(!(t instanceof this.Context))throw new Error("");this._reusableContextStack.push(t),t.currentPath=null},f.reportChanged=function(){this._changeReported=!0},f.wasChangeReported=function(){return this._changeReported};var w=Object.create(null);return w.reset=function(t){if(!(this instanceof this.Context))throw new Error("");if(!(t instanceof o))throw new Error("");return this.currentPath=t,this.needToCallTraverse=!0,this},w.invokeVisitorMethod=function(t){if(!(this instanceof this.Context))throw new Error("");if(!(this.currentPath instanceof o))throw new Error("");var e=this.visitor[t].call(this,this.currentPath);if(!1===e?this.needToCallTraverse=!1:void 0!==e&&(this.currentPath=this.currentPath.replace(e)[0],this.needToCallTraverse&&this.traverse(this.currentPath)),!1!==this.needToCallTraverse)throw new Error("Must either call this.traverse or return false in "+t);var r=this.currentPath;return r&&r.value},w.traverse=function(t,e){if(!(this instanceof this.Context))throw new Error("");if(!(t instanceof o))throw new Error("");if(!(this.currentPath instanceof o))throw new Error("");return this.needToCallTraverse=!1,l(t,c.fromMethodsObject(e||this.visitor))},w.visit=function(t,e){if(!(this instanceof this.Context))throw new Error("");if(!(t instanceof o))throw new Error("");if(!(this.currentPath instanceof o))throw new Error("");return this.needToCallTraverse=!1,c.fromMethodsObject(e||this.visitor).visitWithoutReset(t)},w.reportChanged=function(){this.visitor.reportChanged()},w.abort=function(){this.needToCallTraverse=!1,this.visitor.abort()},c}});
//# sourceMappingURL=sourcemaps/path-visitor.js.map
