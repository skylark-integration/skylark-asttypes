/**
 * skylark-asttypes - A version of asttypes that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./types","./node-path"],function(e,s){"use strict";var w=Object.prototype.hasOwnProperty;return function(t){var c=t.use(e),h=t.use(s),u=c.builtInTypes.array,f=c.builtInTypes.object,l=c.builtInTypes.function;const v=function t(){if(!(this instanceof t))throw new Error("PathVisitor constructor cannot be invoked without 'new'");this._reusableContextStack=[],this._methodNameTable=function(t){var e,r=Object.create(null);for(e in t)/^visit[A-Z]/.test(e)&&(r[e.slice("visit".length)]=!0);for(var i=c.computeSupertypeLookupTable(r),n=Object.create(null),o=Object.keys(i),s=o.length,a=0;a<s;++a){var h=o[a];e="visit"+i[h],l.check(t[e])&&(n[h]=e)}return n}(this),this._shouldVisitComments=w.call(this._methodNameTable,"Block")||w.call(this._methodNameTable,"Line"),this.Context=function(e){function r(t){if(!(this instanceof r))throw new Error("");if(!(this instanceof v))throw new Error("");if(!(t instanceof h))throw new Error("");Object.defineProperty(this,"visitor",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.currentPath=t,this.needToCallTraverse=!0,Object.seal(this)}var t;if(e instanceof v)return(t=r.prototype=Object.create(e)).constructor=r,i(t,o),r;throw new Error("")}(this),this._visiting=!1,this._changeReported=!1};function i(t,e){for(var r in e)w.call(e,r)&&(t[r]=e[r])}v.fromMethodsObject=function(t){var e,r;return t instanceof v?t:new(f.check(t)?((r=(e=function t(){if(!(this instanceof t))throw new Error("Visitor constructor cannot be invoked without 'new'");v.call(this)}).prototype=Object.create(n)).constructor=e,i(r,t),i(e,v),l.assert(e.fromMethodsObject),l.assert(e.visit),e):v)},v.visit=function(t,e){return v.fromMethodsObject(e).visit(t)};var n=v.prototype;function r(t,e){if(!(t instanceof h))throw new Error("");if(!(e instanceof v))throw new Error("");var r=t.value;if(u.check(r))t.each(e.visitWithoutReset,e);else if(f.check(r)){for(var i=c.getFieldNames(r),n=(e._shouldVisitComments&&r.comments&&i.indexOf("comments")<0&&i.push("comments"),i.length),o=[],s=0;s<n;++s){var a=i[s];w.call(r,a)||(r[a]=c.getFieldValue(r,a)),o.push(t.get(a))}for(s=0;s<n;++s)e.visitWithoutReset(o[s])}return t.value}n.visit=function(){if(this._visiting)throw new Error("Recursively calling visitor.visit(path) resets visitor state. Try this.visit(path) or this.traverse(path) instead.");this._visiting=!0,this._changeReported=!1,this._abortRequested=!1;for(var t=arguments.length,e=new Array(t),r=0;r<t;++r)e[r]=arguments[r];e[0]instanceof h||(e[0]=new h({root:e[0]}).get("root")),this.reset.apply(this,e);try{var i=this.visitWithoutReset(e[0]),n=!0}finally{if(this._visiting=!1,!n&&this._abortRequested)return e[0].value}return i},n.AbortRequest=function(){},n.abort=function(){var t=this,e=(t._abortRequested=!0,new t.AbortRequest);throw e.cancel=function(){t._abortRequested=!1},e},n.reset=function(t){},n.visitWithoutReset=function(t){if(this instanceof this.Context)return this.visitor.visitWithoutReset(t);if(!(t instanceof h))throw new Error("");var e=t.value,e=e&&"object"==typeof e&&"string"==typeof e.type&&this._methodNameTable[e.type];if(!e)return r(t,this);t=this.acquireContext(t);try{return t.invokeVisitorMethod(e)}finally{this.releaseContext(t)}},n.acquireContext=function(t){return 0===this._reusableContextStack.length?new this.Context(t):this._reusableContextStack.pop().reset(t)},n.releaseContext=function(t){if(!(t instanceof this.Context))throw new Error("");this._reusableContextStack.push(t),t.currentPath=null},n.reportChanged=function(){this._changeReported=!0},n.wasChangeReported=function(){return this._changeReported};var o=Object.create(null);return o.reset=function(t){if(this instanceof this.Context&&t instanceof h)return this.currentPath=t,this.needToCallTraverse=!0,this;throw new Error("")},o.invokeVisitorMethod=function(t){if(!(this instanceof this.Context))throw new Error("");if(!(this.currentPath instanceof h))throw new Error("");var e=this.visitor[t].call(this,this.currentPath);if(!1===e?this.needToCallTraverse=!1:void 0!==e&&(this.currentPath=this.currentPath.replace(e)[0],this.needToCallTraverse)&&this.traverse(this.currentPath),!1!==this.needToCallTraverse)throw new Error("Must either call this.traverse or return false in "+t);e=this.currentPath;return e&&e.value},o.traverse=function(t,e){if(this instanceof this.Context&&t instanceof h&&this.currentPath instanceof h)return this.needToCallTraverse=!1,r(t,v.fromMethodsObject(e||this.visitor));throw new Error("")},o.visit=function(t,e){if(this instanceof this.Context&&t instanceof h&&this.currentPath instanceof h)return this.needToCallTraverse=!1,v.fromMethodsObject(e||this.visitor).visitWithoutReset(t);throw new Error("")},o.reportChanged=function(){this.visitor.reportChanged()},o.abort=function(){this.needToCallTraverse=!1,this.visitor.abort()},v}});
//# sourceMappingURL=sourcemaps/path-visitor.js.map
