/**
 * skylark-asttypes - A version of asttypes that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(){"use strict";const e=Object.prototype,t=e.toString,r=e.hasOwnProperty;class i{assert(e,t){if(!this.check(e,t)){var r=f(e);throw new Error(r+" does not match type "+this)}return!0}arrayOf(){return new n(this)}}class n extends i{constructor(e){super(),this.elemType=e,this.kind="ArrayType"}toString(){return"["+this.elemType+"]"}check(e,t){return Array.isArray(e)&&e.every(e=>this.elemType.check(e,t))}}class s extends i{constructor(e){super(),this.value=e,this.kind="IdentityType"}toString(){return String(this.value)}check(e,t){const r=e===this.value;return r||"function"!=typeof t||t(this,e),r}}class a extends i{constructor(e){super(),this.fields=e,this.kind="ObjectType"}toString(){return"{ "+this.fields.join(", ")+" }"}check(e,r){return t.call(e)===t.call({})&&this.fields.every(t=>t.type.check(e[t.name],r))}}class l extends i{constructor(e){super(),this.types=e,this.kind="OrType"}toString(){return this.types.join(" | ")}check(e,t){return!!this.types.some(r=>r.check(e,!!t))||("function"==typeof t&&t(this,e),!1)}}class o extends i{constructor(e,t){super(),this.name=e,this.predicate=t,this.kind="PredicateType"}toString(){return this.name}check(e,t){const r=this.predicate(e,t);return r||"function"!=typeof t||t(this,e),r}}class c{constructor(e,t){this.type=e,this.typeName=t,this.baseNames=[],this.ownFields=Object.create(null),this.allSupertypes=Object.create(null),this.supertypeList=[],this.allFields=Object.create(null),this.fieldNames=[],this.finalized=!1,this.buildable=!1,this.buildParams=[]}isSupertypeOf(e){if(e instanceof c){if(!0!==this.finalized||!0!==e.finalized)throw new Error("");return r.call(e.allSupertypes,this.typeName)}throw new Error(e+" is not a Def")}checkAllFields(e,t){var r=this.allFields;if(!0!==this.finalized)throw new Error(""+this.typeName);return null!==e&&"object"==typeof e&&Object.keys(r).every(function(i){var n=r[i],s=n.type,a=n.getValue(e);return s.check(a,t)})}bases(...e){var t=this.baseNames;if(this.finalized){if(e.length!==t.length)throw new Error("");for(var r=0;r<e.length;r++)if(e[r]!==t[r])throw new Error("");return this}return e.forEach(e=>{t.indexOf(e)<0&&t.push(e)}),this}}class u{constructor(e,t,r,i){this.name=e,this.type=t,this.defaultFn=r,this.hidden=!!i}toString(){return JSON.stringify(this.name)+": "+this.type}getValue(e){var t=e[this.name];return void 0!==t?t:("function"==typeof this.defaultFn&&(t=this.defaultFn.call(e)),t)}}function f(e){return Array.isArray(e)?"["+e.map(f).join(", ")+"]":e&&"object"==typeof e?"{ "+Object.keys(e).map(function(t){return t+": "+e[t]}).join(", ")+" }":JSON.stringify(e)}return function(e){const i={or:(...e)=>new l(e.map(e=>i.from(e))),from(e,t){if(e instanceof n||e instanceof s||e instanceof a||e instanceof l||e instanceof o)return e;if(e instanceof c)return e.type;if(w.check(e)){if(1!==e.length)throw new Error("only one element type is permitted for typed arrays");return new n(i.from(e[0]))}if(b.check(e))return new a(Object.keys(e).map(t=>new u(t,i.from(e[t],t))));if("function"==typeof e){var r=h.indexOf(e);if(r>=0)return p[r];if("string"!=typeof t)throw new Error("missing name");return new o(t,e)}return new s(e)},def:e=>r.call(F,e)?F[e]:F[e]=new class extends c{constructor(e){super(new o(e,(e,t)=>this.check(e,t)),e)}check(e,t){if(!0!==this.finalized)throw new Error("prematurely checking unfinalized type "+this.typeName);if(null===e||"object"!=typeof e)return!1;var r=z(e);return r?t&&r===this?this.checkAllFields(e,t):!!this.isSupertypeOf(r)&&(!t||r.checkAllFields(e,t)&&this.checkAllFields(e,!1)):("SourceLocation"===this.typeName||"Position"===this.typeName)&&this.checkAllFields(e,t)}build(...e){if(this.buildParams=e,this.buildable)return this;this.field("type",String,()=>this.typeName),this.buildable=!0;const t=(e,t,i,n)=>{if(!r.call(e,t)){var s=this.allFields;if(!r.call(s,t))throw new Error(""+t);var a,l=s[t],o=l.type;if(n)a=i;else{if(!l.defaultFn){var c="no value or default function given for field "+JSON.stringify(t)+" of "+this.typeName+"("+this.buildParams.map(function(e){return s[e]}).join(", ")+")";throw new Error(c)}a=l.defaultFn.call(e)}if(!o.check(a))throw new Error(f(a)+" does not match field "+l+" of type "+this.typeName);e[t]=a}},i=(...e)=>{var r=e.length;if(!this.finalized)throw new Error("attempting to instantiate unfinalized type "+this.typeName);var i=Object.create(A);if(this.buildParams.forEach(function(n,s){s<r?t(i,n,e[s],!0):t(i,n,null,!1)}),Object.keys(this.allFields).forEach(function(e){t(i,e,null,!1)}),i.type!==this.typeName)throw new Error("");return i};return i.from=(e=>{if(!this.finalized)throw new Error("attempting to instantiate unfinalized type "+this.typeName);var i=Object.create(A);if(Object.keys(this.allFields).forEach(function(n){r.call(e,n)?t(i,n,e[n],!0):t(i,n,null,!1)}),i.type!==this.typeName)throw new Error("");return i}),Object.defineProperty(x,T(this.typeName),{enumerable:!0,value:i}),this}field(e,t,r,n){return this.finalized?(console.error("Ignoring attempt to redefine field "+JSON.stringify(e)+" of finalized type "+JSON.stringify(this.typeName)),this):(this.ownFields[e]=new u(e,i.from(t),r,n),this)}finalize(){if(!this.finalized){var e=this.allFields,t=this.allSupertypes;for(var i in this.baseNames.forEach(r=>{var i=F[r];if(!(i instanceof c)){var n="unknown supertype name "+JSON.stringify(r)+" for subtype "+JSON.stringify(this.typeName);throw new Error(n)}i.finalize(),B(e,i.allFields),B(t,i.allSupertypes)}),B(e,this.ownFields),t[this.typeName]=this,this.fieldNames.length=0,e)r.call(e,i)&&!e[i].hidden&&this.fieldNames.push(i);Object.defineProperty(P,this.typeName,{enumerable:!0,value:this.type}),this.finalized=!0,function(e,t){t.length=0,t.push(e);for(var i=Object.create(null),n=0;n<t.length;++n){e=t[n];var s=F[e];if(!0!==s.finalized)throw new Error("");r.call(i,e)&&delete t[i[e]],i[e]=n,t.push.apply(t,s.baseNames)}for(var a=0,l=a,o=t.length;l<o;++l)r.call(t,l)&&(t[a++]=t[l]);t.length=a}(this.typeName,this.supertypeList),this.buildable&&this.supertypeList.lastIndexOf("Expression")>=0&&function(e){var t=L(e);if(x[t])return;var r=x[T(e)];if(!r)return;const i=function(...e){return x.expressionStatement(r.apply(x,e))};i.from=function(...e){return x.expressionStatement(r.from.apply(x,e))},x[t]=i}(this.typeName)}}}(e),hasDef:e=>r.call(F,e)};var h=[],p=[];function y(e,r){const i=t.call(r),n=new o(e,e=>t.call(e)===i);return r&&"function"==typeof r.constructor&&(h.push(r.constructor),p.push(n)),n}const d=y("string","truthy"),m=y("function",function(){}),w=y("array",[]),b=y("object",{}),g=y("RegExp",/./),v=y("Date",new Date),N=y("number",3),k=y("boolean",!0),O=y("null",null),j=y("undefined",void 0),E="function"==typeof BigInt?y("BigInt",BigInt(1234)):new o("BigInt",()=>!1),S={string:d,function:m,array:w,object:b,RegExp:g,Date:v,number:N,boolean:k,null:O,undefined:j,BigInt:E};var F=Object.create(null);function z(e){if(e&&"object"==typeof e){var t=e.type;if("string"==typeof t&&r.call(F,t)){var i=F[t];if(i.finalized)return i}}return null}var x=Object.create(null),A={};function T(e){return e.replace(/^[A-Z]+/,function(e){var t=e.length;switch(t){case 0:return"";case 1:return e.toLowerCase();default:return e.slice(0,t-1).toLowerCase()+e.charAt(t-1)}})}function L(e){return(e=T(e)).replace(/(Expression)?$/,"Statement")}var P={};function I(e){var t=z(e);if(t)return t.fieldNames.slice(0);if("type"in e)throw new Error("did not recognize object of type "+JSON.stringify(e.type));return Object.keys(e)}function J(e,t){var r=z(e);if(r){var i=r.allFields[t];if(i)return i.getValue(e)}return e&&e[t]}function B(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e}return{Type:i,builtInTypes:S,getSupertypeNames:function(e){if(!r.call(F,e))throw new Error("");var t=F[e];if(!0!==t.finalized)throw new Error("");return t.supertypeList.slice(1)},computeSupertypeLookupTable:function(e){for(var t={},i=Object.keys(F),n=i.length,s=0;s<n;++s){var a=i[s],l=F[a];if(!0!==l.finalized)throw new Error(""+a);for(var o=0;o<l.supertypeList.length;++o){var c=l.supertypeList[o];if(r.call(e,c)){t[a]=c;break}}}return t},builders:x,defineMethod:function(e,t){var r=A[e];return j.check(t)?delete A[e]:(m.assert(t),Object.defineProperty(A,e,{enumerable:!0,configurable:!0,value:t})),r},getBuilderName:T,getStatementBuilderName:L,namedTypes:P,getFieldNames:I,getFieldValue:J,eachField:function(e,t,r){I(e).forEach(function(r){t.call(this,r,J(e,r))},r)},someField:function(e,t,r){return I(e).some(function(r){return t.call(this,r,J(e,r))},r)},finalize:function(){Object.keys(F).forEach(function(e){F[e].finalize()})}}}});
//# sourceMappingURL=sourcemaps/types.js.map
