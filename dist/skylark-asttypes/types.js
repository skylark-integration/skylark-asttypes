/**
 * skylark-asttypes - A version of asttypes that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(){"use strict";var e=Object.prototype;const F=e.toString,z=e.hasOwnProperty;class t{assert(e,t){if(this.check(e,t))return!0;throw t=B(e),new Error(t+" does not match type "+this)}arrayOf(){return new x(this)}}class x extends t{constructor(e){super(),this.elemType=e,this.kind="ArrayType"}toString(){return"["+this.elemType+"]"}check(e,t){return Array.isArray(e)&&e.every(e=>this.elemType.check(e,t))}}class A extends t{constructor(e){super(),this.value=e,this.kind="IdentityType"}toString(){return String(this.value)}check(e,t){var r=e===this.value;return r||"function"!=typeof t||t(this,e),r}}class T extends t{constructor(e){super(),this.fields=e,this.kind="ObjectType"}toString(){return"{ "+this.fields.join(", ")+" }"}check(t,r){return F.call(t)===F.call({})&&this.fields.every(e=>e.type.check(t[e.name],r))}}class L extends t{constructor(e){super(),this.types=e,this.kind="OrType"}toString(){return this.types.join(" | ")}check(t,r){return!!this.types.some(e=>e.check(t,!!r))||("function"==typeof r&&r(this,t),!1)}}class P extends t{constructor(e,t){super(),this.name=e,this.predicate=t,this.kind="PredicateType"}toString(){return this.name}check(e,t){var r=this.predicate(e,t);return r||"function"!=typeof t||t(this,e),r}}class I{constructor(e,t){this.type=e,this.typeName=t,this.baseNames=[],this.ownFields=Object.create(null),this.allSupertypes=Object.create(null),this.supertypeList=[],this.allFields=Object.create(null),this.fieldNames=[],this.finalized=!1,this.buildable=!1,this.buildParams=[]}isSupertypeOf(e){if(e instanceof I){if(!0!==this.finalized||!0!==e.finalized)throw new Error("");return z.call(e.allSupertypes,this.typeName)}throw new Error(e+" is not a Def")}checkAllFields(r,i){var n=this.allFields;if(!0!==this.finalized)throw new Error(""+this.typeName);return null!==r&&"object"==typeof r&&Object.keys(n).every(function(e){var t=(e=n[e]).type,e=e.getValue(r);return t.check(e,i)})}bases(...e){var t=this.baseNames;if(this.finalized){if(e.length!==t.length)throw new Error("");for(var r=0;r<e.length;r++)if(e[r]!==t[r])throw new Error("")}else e.forEach(e=>{t.indexOf(e)<0&&t.push(e)});return this}}class J{constructor(e,t,r,i){this.name=e,this.type=t,this.defaultFn=r,this.hidden=!!i}toString(){return JSON.stringify(this.name)+": "+this.type}getValue(e){var t=e[this.name];return t=void 0===t&&"function"==typeof this.defaultFn?this.defaultFn.call(e):t}}function B(t){return Array.isArray(t)?"["+t.map(B).join(", ")+"]":t&&"object"==typeof t?"{ "+Object.keys(t).map(function(e){return e+": "+t[e]}).join(", ")+" }":JSON.stringify(t)}return function(e){const n={or(...e){return new L(e.map(e=>n.from(e)))},from(t,e){if(t instanceof x||t instanceof A||t instanceof T||t instanceof L||t instanceof P)return t;if(t instanceof I)return t.type;if(l.check(t)){if(1!==t.length)throw new Error("only one element type is permitted for typed arrays");return new x(n.from(t[0]))}if(o.check(t))return new T(Object.keys(t).map(e=>new J(e,n.from(t[e],e))));if("function"!=typeof t)return new A(t);var r=i.indexOf(t);if(0<=r)return s[r];if("string"!=typeof e)throw new Error("missing name");return new P(e,t)},def(e){return z.call(m,e)?m[e]:m[e]=new b(e)},hasDef(e){return z.call(m,e)}};var i=[],s=[];function t(e,t){const r=F.call(t);e=new P(e,e=>F.call(e)===r);return t&&"function"==typeof t.constructor&&(i.push(t.constructor),s.push(e)),e}var r=t("string","truthy");const a=t("function",function(){}),l=t("array",[]),o=t("object",{});var c=t("RegExp",/./),u=t("Date",new Date),f=t("number",3),h=t("boolean",!0),p=t("null",null);const y=t("undefined",void 0);var d="function"==typeof BigInt?t("BigInt",BigInt(1234)):new P("BigInt",()=>!1),r={string:r,function:a,array:l,object:o,RegExp:c,Date:u,number:f,boolean:h,null:p,undefined:y,BigInt:d},m=Object.create(null);function w(e){if(e&&"object"==typeof e){e=e.type;if("string"==typeof e&&z.call(m,e)){e=m[e];if(e.finalized)return e}}return null}class b extends I{constructor(e){super(new P(e,(e,t)=>this.check(e,t)),e)}check(e,t){if(!0!==this.finalized)throw new Error("prematurely checking unfinalized type "+this.typeName);var r;return null!==e&&"object"==typeof e&&((r=w(e))?t&&r===this?this.checkAllFields(e,t):!!this.isSupertypeOf(r)&&(!t||r.checkAllFields(e,t)&&this.checkAllFields(e,!1)):("SourceLocation"===this.typeName||"Position"===this.typeName)&&this.checkAllFields(e,t))}build(...e){if(this.buildParams=e,!this.buildable){this.field("type",String,()=>this.typeName),this.buildable=!0;const s=(e,t,r,i)=>{if(!z.call(e,t)){var n=this.allFields;if(!z.call(n,t))throw new Error(""+t);var s,a=n[t],l=a.type;if(i)s=r;else{if(!a.defaultFn)throw i="no value or default function given for field "+JSON.stringify(t)+" of "+this.typeName+"("+this.buildParams.map(function(e){return n[e]}).join(", ")+")",new Error(i);s=a.defaultFn.call(e)}if(!l.check(s))throw new Error(B(s)+" does not match field "+a+" of type "+this.typeName);e[t]=s}};e=(...r)=>{var i=r.length;if(!this.finalized)throw new Error("attempting to instantiate unfinalized type "+this.typeName);var n=Object.create(v);if(this.buildParams.forEach(function(e,t){t<i?s(n,e,r[t],!0):s(n,e,null,!1)}),Object.keys(this.allFields).forEach(function(e){s(n,e,null,!1)}),n.type!==this.typeName)throw new Error("");return n};e.from=t=>{if(!this.finalized)throw new Error("attempting to instantiate unfinalized type "+this.typeName);var r=Object.create(v);if(Object.keys(this.allFields).forEach(function(e){z.call(t,e)?s(r,e,t[e],!0):s(r,e,null,!1)}),r.type!==this.typeName)throw new Error("");return r},Object.defineProperty(g,N(this.typeName),{enumerable:!0,value:e})}return this}field(e,t,r,i){return this.finalized?console.error("Ignoring attempt to redefine field "+JSON.stringify(e)+" of finalized type "+JSON.stringify(this.typeName)):this.ownFields[e]=new J(e,n.from(t),r,i),this}finalize(){if(!this.finalized){var e,r=this.allFields,i=this.allSupertypes;for(e in this.baseNames.forEach(e=>{var t=m[e];if(!(t instanceof I))throw e="unknown supertype name "+JSON.stringify(e)+" for subtype "+JSON.stringify(this.typeName),new Error(e);t.finalize(),S(r,t.allFields),S(i,t.allSupertypes)}),S(r,this.ownFields),(i[this.typeName]=this).fieldNames.length=0,r)z.call(r,e)&&!r[e].hidden&&this.fieldNames.push(e);Object.defineProperty(O,this.typeName,{enumerable:!0,value:this.type}),this.finalized=!0;var t=this.typeName,n=this.supertypeList;n.length=0,n.push(t);for(var s=Object.create(null),a=0;a<n.length;++a){t=n[a];var l=m[t];if(!0!==l.finalized)throw new Error("");z.call(s,t)&&delete n[s[t]],s[t]=a,n.push.apply(n,l.baseNames)}for(var o=0,c=o,u=n.length;c<u;++c)z.call(n,c)&&(n[o++]=n[c]);n.length=o,this.buildable&&0<=this.supertypeList.lastIndexOf("Expression")&&(f=this.typeName,p=k(f),g[p]||(h=g[N(f)])&&((f=function(...e){return g.expressionStatement(h.apply(g,e))}).from=function(...e){return g.expressionStatement(h.from.apply(g,e))},g[p]=f))}var f,h,p}}var g=Object.create(null),v={};function N(e){return e.replace(/^[A-Z]+/,function(e){var t=e.length;switch(t){case 0:return"";case 1:return e.toLowerCase();default:return e.slice(0,t-1).toLowerCase()+e.charAt(t-1)}})}function k(e){return(e=N(e)).replace(/(Expression)?$/,"Statement")}var O={};function j(e){var t=w(e);if(t)return t.fieldNames.slice(0);if("type"in e)throw new Error("did not recognize object of type "+JSON.stringify(e.type));return Object.keys(e)}function E(e,t){var r=w(e);if(r){r=r.allFields[t];if(r)return r.getValue(e)}return e&&e[t]}function S(t,r){Object.keys(r).forEach(function(e){t[e]=r[e]})}return{Type:n,builtInTypes:r,getSupertypeNames:function(e){if(!z.call(m,e))throw new Error("");if(!0!==(e=m[e]).finalized)throw new Error("");return e.supertypeList.slice(1)},computeSupertypeLookupTable:function(e){for(var t={},r=Object.keys(m),i=r.length,n=0;n<i;++n){var s=r[n],a=m[s];if(!0!==a.finalized)throw new Error(""+s);for(var l=0;l<a.supertypeList.length;++l){var o=a.supertypeList[l];if(z.call(e,o)){t[s]=o;break}}}return t},builders:g,defineMethod:function(e,t){var r=v[e];return y.check(t)?delete v[e]:(a.assert(t),Object.defineProperty(v,e,{enumerable:!0,configurable:!0,value:t})),r},getBuilderName:N,getStatementBuilderName:k,namedTypes:O,getFieldNames:j,getFieldValue:E,eachField:function(t,r,e){j(t).forEach(function(e){r.call(this,e,E(t,e))},e)},someField:function(t,r,e){return j(t).some(function(e){return r.call(this,e,E(t,e))},e)},finalize:function(){Object.keys(m).forEach(function(e){m[e].finalize()})}}}});
//# sourceMappingURL=sourcemaps/types.js.map
