/**
 * skylark-asttypes - A version of asttypes that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./types"],function(a){"use strict";var v=Object.prototype.hasOwnProperty;return function(e){function r(e,t){if(!(this instanceof r))throw new Error("Scope constructor cannot be invoked without 'new'");var a;if(h.check(e.value)||o.assert(e.value),t){if(!(t instanceof r))throw new Error("");a=t.depth+1}else t=null,a=0;Object.defineProperties(this,{path:{value:e},node:{value:e.value},isGlobal:{value:!t,enumerable:!0},depth:{value:a},parent:{value:t},bindings:{value:{}},types:{value:{}}})}var c=e.use(a),e=c.Type,i=c.namedTypes,t=i.Node,s=i.Expression,l=c.builtInTypes.array,n=c.builders,o=e.or(i.Program,i.Function,i.CatchClause),h=e.or(i.Function,i.ClassDeclaration,i.ClassExpression,i.InterfaceDeclaration,i.TSInterfaceDeclaration,i.TypeAlias,i.TSTypeAliasDeclaration),p=e.or(i.TypeParameter,i.TSTypeParameter),e=(r.isEstablishedBy=function(e){return o.check(e)||h.check(e)},r.prototype);function u(a,r,n){var e=a.value;a.parent&&i.FunctionExpression.check(a.parent.node)&&a.parent.node.id&&f(a.parent.get("id"),r),e&&(l.check(e)?a.each(e=>{d(e,r,n)}):i.Function.check(e)?(a.get("params").each(e=>{f(e,r)}),d(a.get("body"),r,n),u(a.get("typeParameters"),r,n)):i.TypeAlias&&i.TypeAlias.check(e)||i.InterfaceDeclaration&&i.InterfaceDeclaration.check(e)||i.TSTypeAliasDeclaration&&i.TSTypeAliasDeclaration.check(e)||i.TSInterfaceDeclaration&&i.TSInterfaceDeclaration.check(e)?y(a.get("id"),n):i.VariableDeclarator.check(e)?(f(a.get("id"),r),d(a.get("init"),r,n)):"ImportSpecifier"===e.type||"ImportNamespaceSpecifier"===e.type||"ImportDefaultSpecifier"===e.type?f(a.get(e.local?"local":e.name?"name":"id"),r):t.check(e)&&!s.check(e)&&c.eachField(e,function(e,t){e=a.get(e);if(!function(e,t){if(e.value===t)return 1;if(Array.isArray(e.value)&&0===e.value.length&&Array.isArray(t)&&0===t.length)return 1;return}(e,t))throw new Error("");d(e,r,n)}))}function d(e,t,a){var r,n=e.value;n&&!s.check(n)&&(i.FunctionDeclaration.check(n)&&null!==n.id?f(e.get("id"),t):i.ClassDeclaration&&i.ClassDeclaration.check(n)&&null!==n.id?(f(e.get("id"),t),u(e.get("typeParameters"),t,a)):i.InterfaceDeclaration&&i.InterfaceDeclaration.check(n)||i.TSInterfaceDeclaration&&i.TSInterfaceDeclaration.check(n)?y(e.get("id"),a):o.check(n)?i.CatchClause.check(n)&&i.Identifier.check(n.param)&&(n=n.param.name,r=v.call(t,n),u(e.get("body"),t,a),r||delete t[n]):u(e,t,a))}function f(e,a){var t=e.value;i.Pattern.assert(t),i.Identifier.check(t)?v.call(a,t.name)?a[t.name].push(e):a[t.name]=[e]:i.AssignmentPattern&&i.AssignmentPattern.check(t)?f(e.get("left"),a):i.ObjectPattern&&i.ObjectPattern.check(t)?e.get("properties").each(function(e){var t=e.value;i.Pattern.check(t)?f(e,a):i.Property.check(t)||i.ObjectProperty&&i.ObjectProperty.check(t)?f(e.get("value"),a):i.SpreadProperty&&i.SpreadProperty.check(t)&&f(e.get("argument"),a)}):i.ArrayPattern&&i.ArrayPattern.check(t)?e.get("elements").each(function(e){var t=e.value;i.Pattern.check(t)?f(e,a):i.SpreadElement&&i.SpreadElement.check(t)&&f(e.get("argument"),a)}):i.PropertyPattern&&i.PropertyPattern.check(t)?f(e.get("pattern"),a):(i.SpreadElementPattern&&i.SpreadElementPattern.check(t)||i.RestElement&&i.RestElement.check(t)||i.SpreadPropertyPattern&&i.SpreadPropertyPattern.check(t))&&f(e.get("argument"),a)}function y(e,t){var a=e.value;i.Pattern.assert(a),i.Identifier.check(a)&&(v.call(t,a.name)?t[a.name].push(e):t[a.name]=[e])}return e.didScan=!1,e.declares=function(e){return this.scan(),v.call(this.bindings,e)},e.declaresType=function(e){return this.scan(),v.call(this.types,e)},e.declareTemporary=function(e){if(e){if(!/^[a-z$_]/i.test(e))throw new Error("")}else e="t$";e+=this.depth.toString(36)+"$",this.scan();for(var t=0;this.declares(e+t);)++t;var a=e+t;return this.bindings[a]=c.builders.identifier(a)},e.injectTemporary=function(e,t){e=e||this.declareTemporary();var a=this.path.get("body");return(a=i.BlockStatement.check(a.value)?a.get("body"):a).unshift(n.variableDeclaration("var",[n.variableDeclarator(e,t||null)])),e},e.scan=function(e){if(e||!this.didScan){for(var t in this.bindings)delete this.bindings[t];for(var t in this.types)delete this.types[t];var a,e=this.path,r=this.bindings,n=this.types,c=e.value;h.check(c)&&(a=e.get("typeParameters","params"),l.check(a.value))&&a.each(e=>{var t,a;t=n,a=(e=e).value,p.assert(a),v.call(t,a.name)?t[a.name].push(e):t[a.name]=[e]}),o.check(c)&&(i.CatchClause.check(c)?f(e.get("param"),r):u(e,r,n)),this.didScan=!0}},e.getBindings=function(){return this.scan(),this.bindings},e.getTypes=function(){return this.scan(),this.types},e.lookup=function(e){for(var t=this;t&&!t.declares(e);t=t.parent);return t},e.lookupType=function(e){for(var t=this;t&&!t.declaresType(e);t=t.parent);return t},e.getGlobalScope=function(){for(var e=this;!e.isGlobal;)e=e.parent;return e},r}});
//# sourceMappingURL=sourcemaps/scope.js.map
