/**
 * skylark-asttypes - A version of asttypes that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./types"],function(e){"use strict";var t=Object.prototype.hasOwnProperty;return function(a){var r=a.use(e),n=r.Type,c=r.namedTypes,i=c.Node,s=c.Expression,l=r.builtInTypes.array,o=r.builders;const h=function e(t,a){if(!(this instanceof e))throw new Error("Scope constructor cannot be invoked without 'new'");var r;if(u.check(t.value)||p.assert(t.value),a){if(!(a instanceof e))throw new Error("");r=a.depth+1}else a=null,r=0;Object.defineProperties(this,{path:{value:t},node:{value:t.value},isGlobal:{value:!a,enumerable:!0},depth:{value:r},parent:{value:a},bindings:{value:{}},types:{value:{}}})};var p=n.or(c.Program,c.Function,c.CatchClause),u=n.or(c.Function,c.ClassDeclaration,c.ClassExpression,c.InterfaceDeclaration,c.TSInterfaceDeclaration,c.TypeAlias,c.TSTypeAliasDeclaration),f=n.or(c.TypeParameter,c.TSTypeParameter);h.isEstablishedBy=function(e){return p.check(e)||u.check(e)};var d=h.prototype;function y(e,t,a){var n=e.value;e.parent&&c.FunctionExpression.check(e.parent.node)&&e.parent.node.id&&g(e.parent.get("id"),t),n&&(l.check(n)?e.each(e=>{v(e,t,a)}):c.Function.check(n)?(e.get("params").each(e=>{g(e,t)}),v(e.get("body"),t,a),y(e.get("typeParameters"),t,a)):c.TypeAlias&&c.TypeAlias.check(n)||c.InterfaceDeclaration&&c.InterfaceDeclaration.check(n)||c.TSTypeAliasDeclaration&&c.TSTypeAliasDeclaration.check(n)||c.TSInterfaceDeclaration&&c.TSInterfaceDeclaration.check(n)?k(e.get("id"),a):c.VariableDeclarator.check(n)?(g(e.get("id"),t),v(e.get("init"),t,a)):"ImportSpecifier"===n.type||"ImportNamespaceSpecifier"===n.type||"ImportDefaultSpecifier"===n.type?g(e.get(n.local?"local":n.name?"name":"id"),t):i.check(n)&&!s.check(n)&&r.eachField(n,function(r,n){var c=e.get(r);if(!function(e,t){if(e.value===t)return!0;if(Array.isArray(e.value)&&0===e.value.length&&Array.isArray(t)&&0===t.length)return!0;return!1}(c,n))throw new Error("");v(c,t,a)}))}function v(e,a,r){var n=e.value;if(!n||s.check(n));else if(c.FunctionDeclaration.check(n)&&null!==n.id)g(e.get("id"),a);else if(c.ClassDeclaration&&c.ClassDeclaration.check(n)&&null!==n.id)g(e.get("id"),a),y(e.get("typeParameters"),a,r);else if(c.InterfaceDeclaration&&c.InterfaceDeclaration.check(n)||c.TSInterfaceDeclaration&&c.TSInterfaceDeclaration.check(n))k(e.get("id"),r);else if(p.check(n)){if(c.CatchClause.check(n)&&c.Identifier.check(n.param)){var i=n.param.name,l=t.call(a,i);y(e.get("body"),a,r),l||delete a[i]}}else y(e,a,r)}function g(e,a){var r=e.value;c.Pattern.assert(r),c.Identifier.check(r)?t.call(a,r.name)?a[r.name].push(e):a[r.name]=[e]:c.AssignmentPattern&&c.AssignmentPattern.check(r)?g(e.get("left"),a):c.ObjectPattern&&c.ObjectPattern.check(r)?e.get("properties").each(function(e){var t=e.value;c.Pattern.check(t)?g(e,a):c.Property.check(t)||c.ObjectProperty&&c.ObjectProperty.check(t)?g(e.get("value"),a):c.SpreadProperty&&c.SpreadProperty.check(t)&&g(e.get("argument"),a)}):c.ArrayPattern&&c.ArrayPattern.check(r)?e.get("elements").each(function(e){var t=e.value;c.Pattern.check(t)?g(e,a):c.SpreadElement&&c.SpreadElement.check(t)&&g(e.get("argument"),a)}):c.PropertyPattern&&c.PropertyPattern.check(r)?g(e.get("pattern"),a):(c.SpreadElementPattern&&c.SpreadElementPattern.check(r)||c.RestElement&&c.RestElement.check(r)||c.SpreadPropertyPattern&&c.SpreadPropertyPattern.check(r))&&g(e.get("argument"),a)}function k(e,a){var r=e.value;c.Pattern.assert(r),c.Identifier.check(r)&&(t.call(a,r.name)?a[r.name].push(e):a[r.name]=[e])}return d.didScan=!1,d.declares=function(e){return this.scan(),t.call(this.bindings,e)},d.declaresType=function(e){return this.scan(),t.call(this.types,e)},d.declareTemporary=function(e){if(e){if(!/^[a-z$_]/i.test(e))throw new Error("")}else e="t$";e+=this.depth.toString(36)+"$",this.scan();for(var t=0;this.declares(e+t);)++t;var a=e+t;return this.bindings[a]=r.builders.identifier(a)},d.injectTemporary=function(e,t){e||(e=this.declareTemporary());var a=this.path.get("body");return c.BlockStatement.check(a.value)&&(a=a.get("body")),a.unshift(o.variableDeclaration("var",[o.variableDeclarator(e,t||null)])),e},d.scan=function(e){if(e||!this.didScan){for(var a in this.bindings)delete this.bindings[a];for(var a in this.types)delete this.types[a];!function(e,a,r){var n=e.value;if(u.check(n)){const a=e.get("typeParameters","params");l.check(a.value)&&a.each(e=>{s=r,o=(i=e).value,f.assert(o),t.call(s,o.name)?s[o.name].push(i):s[o.name]=[i]})}var i,s,o;p.check(n)&&(c.CatchClause.check(n)?g(e.get("param"),a):y(e,a,r))}(this.path,this.bindings,this.types),this.didScan=!0}},d.getBindings=function(){return this.scan(),this.bindings},d.getTypes=function(){return this.scan(),this.types},d.lookup=function(e){for(var t=this;t&&!t.declares(e);t=t.parent);return t},d.lookupType=function(e){for(var t=this;t&&!t.declaresType(e);t=t.parent);return t},d.getGlobalScope=function(){for(var e=this;!e.isGlobal;)e=e.parent;return e},h}});
//# sourceMappingURL=sourcemaps/scope.js.map
